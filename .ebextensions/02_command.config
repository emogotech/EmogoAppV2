commands:
    00_pip_upgrade:
        command: /opt/python/run/venv/bin/pip install --upgrade pip
        ignoreErrors: true
        leader_only: true

    01_pip_install:
        command: /opt/python/run/venv/bin/pip install -r /opt/python/ondeck/app/requirements.txt
        ignoreErrors: true
        leader_only: true
    
    02_pip_install:
        command: 2to3 -w /opt/python/run/venv/local/lib/python3.6/site-packages/apns.py
        ignoreErrors: true
        leader_only: true

    WSGIPassAuthorization:
        command: sed -i.bak '/WSGIScriptAlias/ a WSGIPassAuthorization On' config.py
        cwd: /opt/elasticbeanstalk/hooks

container_commands:

    101_make_migrations:
        command: "source /opt/python/run/venv/bin/activate && python /opt/python/ondeck/app/manage.py makemigrations"
        cwd: /opt/python/ondeck/app/
        ignoreErrors: true
        leader_only: true

    102_migrate:
        command: "source /opt/python/run/venv/bin/activate && python /opt/python/ondeck/app/manage.py migrate"
        cwd: /opt/python/ondeck/app/
        ignoreErrors: true
        leader_only: true

    103_collectstatic:
        command: "source /opt/python/run/venv/bin/activate && python manage.py collectstatic --noinput"
        cwd: /opt/python/ondeck/app/
        ignoreErrors: true
        leader_only: true

